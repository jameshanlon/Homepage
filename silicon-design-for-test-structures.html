<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="James W. Hanlon">
  <title>Silicon design for test structures</title>
  <link rel="icon" href="./favicon.png" sizes="16x16" type="image/png">
  <link rel="stylesheet" type="text/css" href="./theme/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="./theme/css/lightbox.min.css">
  <link rel="stylesheet" type="text/css" href="./theme/css/main.css"/>
  <link href="http://jameswhanlon.com/reeds/atom.xml"
      type="application/atom+xml" rel="alternate"
      title="James W. Hanlon Atom Feed" />
  <link href="http://jameswhanlon.com/reeds/rss.xml"
      type="application/rss+xml" rel="alternate"
      title="James W. Hanlon RSS Feed" />
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML'></script>
</head>
<body>
	<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
		<button class="navbar-toggler" type="button" data-toggle="collapse"
						data-target="#navbarsExampleDefault"
						aria-controls="navbarsExampleDefault"
						aria-expanded="false"
						aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarsExampleDefault">
			<ul class="navbar-nav mr-auto text-uppercase">
          <li class="nav-item ">
            <a class="nav-link" href="/index.html">notes</a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="/archive.html">archive</a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="/about.html">about</a>
          </li>
			</ul>
		  <a class="navbar-brand" href="/index.html">James W. Hanlon</a>
		</div>
	</nav>
  <div class="container">
  <h1>
    Silicon design for test&nbsp;structures
  </h1>
  <div class="lead">
    <time class="published" datetime="2019-04-18T00:00:00+02:00">
      18 Apr 2019
    </time><br>
      <span class="article-tag small"><a href="/tag/microelectronics.html">microelectronics</a></span>
  </div>
  <div class="article-body">
    <p>Design for test (<span class="caps">DFT</span>) is a methodology for silicon integrated-circuit chips to
allow the devices to be tested during manufacture. Such testability permits the
detection of defects due to problems in the manufacturing processes that would
adversely affect the functional behaviour of the device. This note explains
some of the concepts of <span class="caps">DFT</span> applied to chip design, particularly focusing on
the structures that are inserted to functional&nbsp;logic.</p>
<h2>Scan&nbsp;chains</h2>
<p>A chip can be viewed as a set of input ports that feed into a series of
combinatorial and sequential cells, and arrive at a set of output ports. To
test that the function of the chip is correct, it would suffice to check that a
particular output is generated for a particular input, or sequence of inputs
and outputs. However, if the intervening logic contains sequential elements, is
computationally difficult to setup inputs each clock cycle to observe desired
values on all outputs. Doing so requires sequencing of state transitions
through the logic, but the size of the state space grows exponentially with the
number of&nbsp;states.</p>
<figure class="figure d-block text-center">
  <img src="https://jwh.ams3.digitaloceanspaces.com/homepage/DFT/chip.png" class="figure-img img-fluid rounded">
  <figcaption class="figure-caption">
    Conceptually, a silicon chip is a set of input ports driving logic with
sequential elements, in turn driving output ports.
  </figcaption>
</figure>

<p>To avoid an intractable state space, the design is changed so that inputs and
observable outputs are separated only by combinatorial logic. This is done by
adding new controllable <strong>primary inputs</strong> and <strong>observable outputs</strong>, called
<strong>scan chains</strong>. A scan chain adds three ports to the chip: a scan chain input,
<code>scan_in</code>, a scan chain output <code>scan_out</code> and an enable <code>scan_enable</code>.
All registers are converted by adding a multiplexer on the D pin, with one
input connected to the data signal. The first scan-chain register has it’s
other multiplexer input connected to <code>scan_in</code>. Subsequent scan registers
take their other multiplexer inputs from the output of the previous register in
the chain. The final register in the chain drives <code>scan_out</code> from it’s D pin.
All multiplexers are controlled by <code>scan_enable</code>.</p>
<figure class="figure d-block text-center">
  <img src="https://jwh.ams3.digitaloceanspaces.com/homepage/DFT/scan-flop.png" class="figure-img img-fluid rounded">
  <figcaption class="figure-caption">
    A standard flip flop (left) and a scanned flip flop with scan-in and
scan-enable inputs (right).
  </figcaption>
</figure>

<figure class="figure d-block text-center">
  <img src="https://jwh.ams3.digitaloceanspaces.com/homepage/DFT/scan-chains.png" class="figure-img img-fluid rounded">
  <figcaption class="figure-caption">
    Scan chain topology providing a set of controllable primary inputs and a set of observable outputs.
  </figcaption>
</figure>

<p>When <code>scan_enable</code> is pulled high, and the clock pulsed, data is shifted into
each register in the chain. Each bit of a chain of N registers can be set in N
clock cycles. When pulled low, the chip is in normal functional mode. These
inputs allow a simple test procedure to be&nbsp;implemented:</p>
<ol>
<li>Set <code>scan_enable</code> high (scan&nbsp;mode).</li>
<li>Shift in N bits of input&nbsp;data.</li>
<li>Set <code>scan_enable</code> low (functional&nbsp;mode).</li>
<li>Tick the clock once to propagate input vector though combinatorial logic into&nbsp;outputs.</li>
<li>Set <code>scan_enable</code> high (scan&nbsp;mode).</li>
<li>Shift out N bits of output&nbsp;data.</li>
<li>Check that the output data equals the input data transformed by the same logic&nbsp;function.</li>
</ol>
<p>Since typical tests will contain large numbers of patterns, the time to test
one pattern is critical. It is determined by the length of the chain, to shift
in and out data. To reduce test time, additional scan chains can be introduced
to allow shifting to be performed in parallel. Each chain adds <code>scan_in</code> and
<code>scan_out</code> ports to the chip. The number of scan chains is chosen to trade
off the physical requirements of the additional ports and routing with test
time and coverage. To avoid many additional ports at the top level, a set of
parallel scan chains can be driven by <span class="caps">DFT</span> logic that supplies compressed
patterns to the inputs and compresses results from the&nbsp;outputs.</p>
<figure class="figure d-block text-center">
  <img src="https://jwh.ams3.digitaloceanspaces.com/homepage/DFT/parallel-scan-chains.png" class="figure-img img-fluid rounded">
  <figcaption class="figure-caption">
    Parallel scan chains to reduce test time.
  </figcaption>
</figure>

<h2>Wrapper&nbsp;chains</h2>
<p>Typically, a chip is too complex to test with a single set of scan chains. Even
with only combinatorial logic between primary inputs and observable outputs, it
becomes computationally difficult to analyse to generate patterns that can
effectively exercise it to achieve good coverage and fault isolation. Instead,
a chip is divided into sub components, each of which is amenable to testing (an
approach known as hierarchical <span class="caps">DFT</span>). The components are referred to as <strong>test
cores</strong> and typically naturally correspond to functional blocks of the chip&nbsp;design.</p>
<p>It is necessary for a test core to be isolated from the rest of the design. At
a chip-level primary inputs are controllable in that their values are always
known. However, the values of an input to a test core are unknown and likely to
be Xs. If X values propagate into a test core, coverage can be reduced, or
worse, the testing methodology may be invalidated altogether. Isolation is
achieved with <strong>wrapper chains</strong> that are inserted between the <span class="caps">IO</span> ports and the
core logic of the design. A bypass multiplexer is inserted on the output of the
wrapper scan register to control whether the input or output is used or driven
respectively. If the input or output is directly connected to a register, then
a bypass is not&nbsp;necessary.</p>
<figure class="figure d-block text-center">
  <img src="https://jwh.ams3.digitaloceanspaces.com/homepage/DFT/wrapper-flop.png" class="figure-img img-fluid rounded">
  <figcaption class="figure-caption">
    Wrapper flops inserted on input and output ports.
  </figcaption>
</figure>

<figure class="figure d-block text-center">
  <img src="https://jwh.ams3.digitaloceanspaces.com/homepage/DFT/test-core.png" class="figure-img img-fluid rounded">
  <figcaption class="figure-caption">
    A test core isolated with input and output wrapper chains. One or more
additional scan chains may be connected to sequential elements of the core logic.
  </figcaption>
</figure>

<p>An <strong>input wrapper chain</strong> is the chain of registers that capture the primary
inputs to the core, with their D inputs corresponding to each input of the test
core. Some inputs may be omitted from the wrapper chain, such as clock, reset
and test-related signals. Input wrapper chains are different to regular scan
chains only in the way that their <code>scan_enable</code> is controlled. During test mode,
the scan enable of the input wrapper is held high when the regular <code>scan_enable</code>
is low and all other registers are in functional mode. The effect of this is
that the input wrapper chain continues to shift in known values, rather than Xs
from outside of the test core. When the input wrapper registers are not shared
with any other test core, the captured values can be shifted out with the other
test pattern results to ensure all of the registers are functioning&nbsp;correctly.</p>
<p>An <strong>output wrapper chain</strong> behaves exactly as an internal scan chain during test
mode. However, when they are shared with an adjacent test core, their
<code>scan_enable</code> is controlled differently since they will function as an input
wrapper chain for that core, with the behaviour described&nbsp;above.</p>
<figure class="figure d-block text-center">
  <img src="https://jwh.ams3.digitaloceanspaces.com/homepage/DFT/adjacent-test-cores.png" class="figure-img img-fluid rounded">
  <figcaption class="figure-caption">
    Test core B shares core B&#8217;s output wrapper chain, using it as an input wrapper chain in test mode.
  </figcaption>
</figure>

<h2>X&nbsp;bounding</h2>
<p>It may not be possible to add all registers into the scan chains for a design.
In this case, to prevent Xs from propagating into the logic during test, all
sources of Xs must be masked with known values. This is done by inserting a
multiplexer to take the Q pin as input, with the other input as an alternative
known value, typically from a register on a scan chain. The multiplexer is
controlled by an <code>xbnd_enable</code> signal, which when set high will prevent X
propagation during test mode, and otherwise maintains the functional behaviour
of the&nbsp;circuit.</p>
<figure class="figure d-block text-center">
  <img src="https://jwh.ams3.digitaloceanspaces.com/homepage/DFT/xbnd-flop.png" class="figure-img img-fluid rounded">
  <figcaption class="figure-caption">
    A X-source flop with bypass multiplexing of a known value.
  </figcaption>
</figure>

<h2>References / further&nbsp;reading</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Design_for_testing">Design for testing&nbsp;(Wikipedia)</a></li>
<li><a href="https://en.wikipedia.org/wiki/Automatic_test_pattern_generation">Automatic test pattern generation&nbsp;(Wikipedia)</a></li>
<li><a href="http://web.stanford.edu/class/archive/ee/ee371/ee371.1066/lectures.html">Stanford <span class="caps">EE371</span>, lecture 14: Design for&nbsp;testability</a></li>
</ul>
<h2>Acknowledgements</h2>
<p>Thanks to Evan Griffiths for his detailed explanations of <span class="caps">DFT</span> insertion, upon
which this note is&nbsp;based.</p>
  </div>
  <div class="article-footer">
    <p>Please get in touch (mail @ this domain) with any
    comments, corrections or suggestions.</p>
  </div>
  </div>
  <hr>
  <footer class="text-muted">
    <div class="container">
      <!--<p class="float-right" style="padding-left:1em">
        <a href="https://github.com/jameshanlon">
        <span>
          <svg viewBox="0 0 16 16" width="16px" height="16px">
            <path fill="#828282"
               d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
               c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
               c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
               c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
               C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
               c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
               c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
               c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
               c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z">
            </path>
          </svg>
        </span>
        <span>jameshanlon</span><br>
        </a>
        <a href="https://twitter.com/jameswhanlon">
          <span>
            <svg viewBox="0 0 16 16" width="16px" height="16px">
              <path fill="#828282"
                d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
                c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
                c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
                C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
                c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
                c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z">
              </path>
            </svg>
          </span>
          <span class="username">@jameswhanlon</span>
        </a>
      </p>
      <p>-->
      <div class="small">
        <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
          <img alt="Creative Commons Licence" style="border-width:0"
               src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
        </a><br>
        Unless otherwise noted, all content is freely available under a
        <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
          Creative Commons Attribution 4.0 International License</a>.<br>
        Subscribe: <a href="http://jameswhanlon.com/reeds/atom.xml">Atom</a> /
        <a href="http://jameswhanlon.com/reeds/rss.xml">RSS</a>
      </div>
    </div>
  </footer>
  <script src="./theme/js/jquery.min.js"></script>
  <script src="./theme/js/popper.min.js"></script>
  <script src="./theme/js/bootstrap.min.js"></script>
  <script src="./theme/js/lightbox.min.js"></script>
  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <script src="./theme/js/ie10-viewport-bug-workaround.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-19458374-1', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>