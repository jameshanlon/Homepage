<!DOCTYPE html>
<!-- Make light mode the default for articles since this works better with
    images with a white background and code highlighting. -->
<html lang="en" data-bs-theme=light>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="James W. Hanlon">
  <title>RGB lightboxÂ stacks</title>
  <link rel="icon" type="image/png" sizes="32x32" href="./theme/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./theme/images/favicon-16x16.png">
  <link rel="stylesheet" type="text/css" href="./theme/css/main.css"/>
  <!-- Default Pygments style -->
  <link rel="stylesheet" type="text/css" href="./theme/css/pygments.css" id="pygments-style"/>
  <link href="https://jameswhanlon.com/reeds/atom.xml"
        type="application/atom+xml" rel="alternate"
        title="James W. Hanlon Atom Feed" />
  <link href="https://jameswhanlon.com/reeds/rss.xml"
        type="application/rss+xml" rel="alternate"
        title="James W. Hanlon RSS Feed" />
  <!-- MathJax -->
  <script>
  MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
              svg: { fontCache: 'global' } };
  </script>
  <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
  </script>
  <script src="./theme/js/bundle.js"></script>
  <script data-goatcounter="https://jameswhanlon.goatcounter.com/count"
          async src="//gc.zgo.at/count.js"></script>
</head>
<body>
  <header>
  <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav me-auto mb-2 mb-md-0 text-uppercase">
          <li class="nav-item">
              <a class="nav-link" href="/index.html">notes</a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="/projects.html">projects</a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="/archive.html">archive</a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="/about.html">about</a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="/links.html">links</a>
          </li>
        </ul>
        <a class="navbar-brand" href="#">James W. Hanlon</a>
        <button class="btn btn-secondary" type="button" onclick="toggleMode(this)">
          <!-- Initial button state -->
            <i class="bi bi-moon-fill"></i>
        </button>
      </div>
    </div>
  </nav>
  </header>

  <main class="flex-shrink-0">
  <div class="container">
  <h1>
    <span class="caps">RGB</span> lightbox&nbsp;stacks
  </h1>
  <div class="lead">
    <time class="published" datetime="2018-12-31T00:00:00+01:00">
      31 Dec 2018
    </time><br>
      <span class="article-tag small"><a href="/tag/lighting.html">lighting</a></span>
      <span class="article-tag small"><a href="/tag/electronics.html">electronics</a></span>
  </div>
  <div class="article-body">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/completed-boxes-3.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/completed-boxes-3_800x800.jpg" alt="No alt text">
  </a>
</div>

<p>The &#8216;<span class="caps">RGB</span> stacks&#8217; lightboxes are an experiment with using high-power LEDs,
generous volumes and translucent acrylic plastic to create big blocks of
colour. They are constructed from 12 mm birch ply and each pixel measures 300 x
300 (outer dimensions). They are built as three columns of three pixels to
allow them to be arranged in a square, a line, or in different locations. This
note records some of the details of their construction. Although they are now
functional, refinement of their controls and modulation continues to be a work
in progress. This note records some of the details of how they were built (I
will it updated with any new&nbsp;developments).</p>
<p>The project was inspired by a similar light box project (that unfortunately I
can no longer find on the internet), but which was a single 3 x 3 cabinet
achieving a similar block-colour effect. My motivation was to build something
similar but that could also be used as subtle/ambient lighting, making use of
the amazing colours and ability to accurately modulate LEDs to create smooth
transitions between rich colours and interesting&nbsp;combinations.</p>
<figure class="figure">
<div class="container">
  <div class="row align-items-center">
    <div class="col">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/colour-experiment-blue.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/colour-experiment-blue_600x600.jpg" alt="No alt text">
  </a>
</div>

    </div>
    <div class="col">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/colour-experiment-red.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/colour-experiment-red_600x600.jpg" alt="No alt text">
  </a>
</div>

    </div>
  </div>
</div>
<figcaption class="figure-caption">An early experiment to see how the <span class="caps">LED</span> light diffuses through the acrylic in a plywood volume.</figcaption>
</figure>

<p>Construction of the stacks was straightforward: all panel dimensions are
multiples of 300 and all joints biscuited and glued to avoid any visible
fixings. (I unfortunately don&#8217;t have any pictures of the construction of the&nbsp;stacks.)</p>
<figure class="figure">
<div class="container">
  <div class="row align-items-center">
    <div class="col">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/bead-detail-1.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/bead-detail-1_600x600.jpg" alt="No alt text">
  </a>
</div>

    </div>
    <div class="col">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/bead-detail-2.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/bead-detail-2_600x600.jpg" alt="No alt text">
  </a>
</div>

    </div>
    <div class="col">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/tape.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/tape_600x600.jpg" alt="No alt text">
  </a>
</div>

    </div>
  </div>
</div>
<figcaption class="figure-caption">Detail of the lip added to seat the acrylic panels and the narrow double-sided tape to fix them in place.</figcaption>
</figure>

<p>The acrylic panels were cut to fit the inner box dimensions exactly, but with
small variations in the dimensions of the boxes. Getting them all to fit was a
long process of sanding down each one to fit a particular opening. A secure fit
of the panels was achieved with tight tolerances and narrow double-sided sticky
tape (pictured above&nbsp;right).</p>
<div class="text-center">
<figure class="figure">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/completed-boxes-1.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/completed-boxes-1_600x600.jpg" alt="The boxes with all acrylic panels in place.">
  </a>
  <figcaption class="figure-caption text-left">The boxes with all acrylic panels in place.</figcaption>
</figure>
</div>

<p>Pairs of white and <span class="caps">RGB</span> LEDs were mounted on aluminium bar in each pixel. The
<span class="caps">LED</span> were fixed in place with small bolts. I made small plastic washers to avoid
shorting any of the contacts with the bolt heads. Although the aluminium bar
probably provides a sufficient heat sink, I added additional heatsink blocks on
the rear side, fixed with thermal glue (these were cut up from larger <span class="caps">IC</span>
heatsinks). All of the <span class="caps">LED</span> wiring was conveniently done with <span class="caps">CAT6</span> cable, using
all of the eight cores to wire the four channels. Each channel draws about
1 W at 5 V (200 mA), which is within the specification of the <span class="caps">CAT6</span>.</p>
<figure class="figure">
<div class="container">
  <div class="row align-items-center">
    <div class="col">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/led-bar-2.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/led-bar-2_600x600.jpg" alt="No alt text">
  </a>
</div>

    </div>
    <div class="col">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/led-heatsinks.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/led-heatsinks_600x600.jpg" alt="No alt text">
  </a>
</div>

    </div>
  </div>
</div>
<figcaption class="figure-caption">The system used to mount the LEDs in the middle of each box.</figcaption>
</figure>

<figure class="figure">
<div class="container">
  <div class="row align-items-center">
    <div class="col">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/skeleton-boxes-with-leds.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/skeleton-boxes-with-leds_600x600.jpg" alt="No alt text">
  </a>
</div>

    </div>
    <div class="col">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/boxes-in-workshop.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/boxes-in-workshop_600x600.jpg" alt="No alt text">
  </a>
</div>

    </div>
  </div>
</div>
<figcaption class="figure-caption">The boxes with all of the LEDs and their cabling installed.</figcaption>
</figure>

<p>Each box has a rear plug panel. The central box acts as a master and has
connections for power, Ethernet, and provides serial data and power to the
other outer&nbsp;boxes.</p>
<figure class="figure">
<div class="container">
  <div class="row align-items-center">
    <div class="col">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/power-supply.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/power-supply_600x600.jpg" alt="No alt text">
  </a>
</div>

    </div>
    <div class="col">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/plug-panel.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/plug-panel_600x600.jpg" alt="No alt text">
  </a>
</div>

    </div>
    <div class="col">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/slave-box-control-boards.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/slave-box-control-boards_600x600.jpg" alt="No alt text">
  </a>
</div>

    </div>
  </div>
</div>
<figcaption class="figure-caption">The master and slave plug panels for each stack.</figcaption>
</figure>

<p>The inter-box wiring uses 5-pin <span class="caps">XLR</span> sockets, to carry power, ground and the
differential pair for the serial signal. The wires were made with a dual-core
power wire (sufficient to carry the required power at 5V) with a another
dual-core wire for the serial, wrapped in a heatshrink&nbsp;coat.</p>
<div class="text-center">
<figure class="figure">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/cables.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/cables_600x600.jpg" alt="Custom cabling to connect the left and right hand boxes, containing a dual-core wire for power and two CAT-6 cores for serial data.">
  </a>
  <figcaption class="figure-caption text-left">Custom cabling to connect the left and right hand boxes, containing a dual-core wire for power and two <span class="caps">CAT</span>-6 cores for serial data.</figcaption>
</figure>
</div>

<p>The electronics for the <span class="caps">LED</span> drivers is described in a <a href="./three-channel-high-power-led-driver.html">separate
note</a>. Each of the <span class="caps">LED</span> driver boards has three
outputs, so four boards are required to drive a single stack. The Raspberry Pi
microcontroller is used to control all the pixels, and does so with a dual-wire
<span class="caps">RS</span>-485 serial bus. This bus connects each of the driver boards in series, and
the outer boxes are wired in parallel. Despite some concerns about this
topology from notes on the <span class="caps">MAX</span>-485 driver <span class="caps">IC</span> datasheet and that I didn&#8217;t use
terminating resistors, the arrangement performs&nbsp;fine.</p>
<p>So that I could easily access the electronics, I integrated the drivers and
their wiring on a plywood board that sits in the base of a stack. The master
stack has the power supply, taking mains voltage and providing 5V up to 60W
(12A) for the three stacks. See the table below for calculated power of the
LEDs only. Note that the power supply does not output enough power do drive
the boxes comfortably (80W would be more&nbsp;comfortable).</p>
<table class="table table-sm">
  <thead>
    <tr>
      <th scope="col">Channel</th>
      <th scope="col">Voltage (V)</th>
      <th scope="col">Current (A)</th>
      <th scope="col"><span class="caps">LED</span> power (W)</th>
      <th scope="col">Driver efficiency</th>
      <th scope="col">Driver power (W)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Red</td>
      <td>2.4</td>
      <td>0.3</td>
      <td>0.72</td>
      <td>0.48</td>
      <td>1.5</td>
    </tr>
    <tr>
      <td>Green</td>
      <td>3.4</td>
      <td>0.3</td>
      <td>1.02</td>
      <td>0.68</td>
      <td>1.5</td>
    </tr>
    <tr>
      <td>Blue</td>
      <td>3.5</td>
      <td>0.3</td>
      <td>1.05</td>
      <td>0.7</td>
      <td>1.5</td>
    </tr>
    <tr>
      <td>White</td>
      <td>3.2</td>
      <td>0.3</td>
      <td>0.96</td>
      <td>0.64</td>
      <td>1.5</td>
    </tr>
    <tr>
      <td>Total (per pixel)</td>
      <td>-</td>
      <td>-</td>
      <td>3.75</td>
      <td>-</td>
      <td>6</td>
    </tr>
    <tr>
      <td>Total (per stack)</td>
      <td>-</td>
      <td>-</td>
      <td>11.25</td>
      <td>-</td>
      <td>18</td>
    </tr>
    <tr>
      <td>Total</td>
      <td>-</td>
      <td>-</td>
      <td>33.75</td>
      <td>-</td>
      <td>54</td>
    </tr>
  </tbody>
</table>

<p>To check the above power numbers I performed some measurments with a clamp
meter of the central&nbsp;stack:</p>
<ul>
<li>With all LEDs off, the quiesence current is 360 mA at 5 V, dissipating 1.8&nbsp;W.</li>
<li>With all LEDs on at full intensity, the current is 4.75 A at 5 V, dissipating
  23.75&nbsp;W.</li>
</ul>
<p>These numbers are slightly higher than expected, due to the <span class="caps">LED</span> driver current
ranging between 0.357 mA (blue) and 0.370 mA&nbsp;(green).</p>
<figure class="figure">
<div class="container">
  <div class="row align-items-center">
    <div class="col">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/control-board-and-psu.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/control-board-and-psu_600x600.jpg" alt="No alt text">
  </a>
</div>

    </div>
    <div class="col">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/control-board-1.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/control-board-1_600x600.jpg" alt="No alt text">
  </a>
</div>

    </div>
    <div class="col">
    <div class="text-center">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/one-stack-test-with-board.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/one-stack-test-with-board_600x600.jpg" alt="No alt text">
  </a>
</div>

    </div>
  </div>
</div>
<figcaption class="figure-caption">Integration of the electronics into the master stack (similar for the outer stacks).</figcaption>
</figure>

<p>The back panels fasten with M8 bolts into&nbsp;T-nuts.</p>
<figure class="figure">
<div class="container">
  <div class="row align-items-center">
    <div class="col">
    <div class="text-center">
<figure class="figure">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/back-panels.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/back-panels_600x600.jpg" alt="Details of the back plates, fastened by M8 Allen key bolts.">
  </a>
  <figcaption class="figure-caption text-left">Details of the back plates, fastened by M8 Allen key bolts.</figcaption>
</figure>
</div>

    </div>
    <div class="col">
    <div class="text-center">
<figure class="figure">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/completed-boxes-2.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/completed-boxes-2_600x600.jpg" alt="The boxes in a complete state">
  </a>
  <figcaption class="figure-caption text-left">The boxes in a complete state</figcaption>
</figure>
</div>

    </div>
  </div>
</div>
<figcaption class="figure-caption"></figcaption>
</figure>

<p>It&#8217;s hard to capture the quality of the effect of the light boxes on camera.
The images below are two early tests: left just using a lamp in one of the
pixels, right with no blending of the <span class="caps">RGB</span>&nbsp;channels.</p>
<figure class="figure">
<div class="container">
  <div class="row align-items-center">
    <div class="col">
    <div class="text-center">
<figure class="figure">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/one-cell-illuminated.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/one-cell-illuminated_600x600.jpg" alt="Seeing the effect of the acrylic diffusion with just a lamp in one of the cells.">
  </a>
  <figcaption class="figure-caption text-left">Seeing the effect of the acrylic diffusion with just a lamp in one of the cells.</figcaption>
</figure>
</div>

    </div>
    <div class="col">
    <div class="text-center">
<figure class="figure">
  <a href="https://jwh.ams3.digitaloceanspaces.com/homepage/RGB-stacks/rgb-test.jpg" data-lightbox="all">
    <img class="figure-img img-fluid thumbnail" src="/thumbs/rgb-test_600x600.jpg" alt="The first RGB test of a stack.">
  </a>
  <figcaption class="figure-caption text-left">The first <span class="caps">RGB</span> test of a stack.</figcaption>
</figure>
</div>

    </div>
  </div>
</div>
<figcaption class="figure-caption"></figcaption>
</figure>

<p>The behaviour of the boxes is determined by the <span class="caps">PIC</span> programs and the Raspberry
Pi. Since changes to the <span class="caps">PIC</span> program requires each of the boards to be
programmed individually and for each program to be compiled with a unique
identifier, this is not an easy way to experiment with modulating schemes.
Instead, each <span class="caps">PIC</span> is programmed only to change the output intensity, and
experimentation can be done using Python on the Raspberry Pi over <span class="caps">SSH</span>. In these
scheme, updates are sent to the <span class="caps">LED</span> drivers synchronously, as a frame. At
115,200 bps baud rate over <span class="caps">RS485</span>, this is sufficient to deliver up to 389
updates per second. In practice there are overheads that will reduce this. If,
for smooth graduations between colours the frame rate was not adequate, an
optimisation could be to expand the capability of the <span class="caps">PIC</span> driver code to
perform more complex actions like sweeps over intensity ranges, thereby
reducing the number of updates&nbsp;required.</p>
<p>As I mentioned, these boxes are not yet complete. To finish them, I want to add
a button panel to switch them on off and control the lighting&nbsp;patterns.</p>
<h2>References</h2>
<ul>
<li><a href="https://github.com/jameshanlon/PIC12F1572-pwm"><span class="caps">PIC12F1572</span> <span class="caps">PWM</span>&nbsp;example</a></li>
<li><a href="https://github.com/jameshanlon/PIC12F1572-uart"><span class="caps">PIC12F1572</span> <span class="caps">UART</span>&nbsp;example</a></li>
</ul>
  </div>
  <div class="article-footer">
    <p>Please get in touch (mail @ this domain) with any
    comments, corrections or suggestions.</p>
  </div>
  </div>
  </main>

  <hr>
  <footer class="text-muted">
    <div class="container">
      <div class="small">
        <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
          <img alt="Creative Commons Licence" style="border-width:0"
               src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
        </a>
        <br>
        Unless otherwise noted, all content is freely available under a
        <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
          Creative Commons Attribution 4.0 International License</a>.<br>
        The views expressed on this website are the authorâs personal views and should not be
        attributed to any other person, including that of their employer.<br>
        <br>
        Subscribe: <a href="https://jameswhanlon.com/reeds/atom.xml">Atom</a> /
        <a href="https://jameswhanlon.com/reeds/rss.xml">RSS</a>
      </div>
    </div>
  </footer>
  <script>
    function toggleMode(x) {
      // Toggle the colour mode in Bootstrap.
      if (document.documentElement.getAttribute('data-bs-theme') == 'dark') {
        document.documentElement.setAttribute('data-bs-theme','light')
      }
      else {
        document.documentElement.setAttribute('data-bs-theme','dark')
      }
      // Toggle the light/dark icon.
      x.firstElementChild.classList.toggle('bi-brightness-high-fill');
      x.firstElementChild.classList.toggle('bi-moon-fill');
      // Toggle the Pygments style.
      var elem = document.getElementById('pygments-style');
      if (elem.getAttribute('href') == 'pygments-dark.css') {
        elem.setAttribute('href', 'pygments.css');
      } else {
        elem.setAttribute('href', 'pygments-dark.css');
      }
    }
  </script>
</body>
</html>